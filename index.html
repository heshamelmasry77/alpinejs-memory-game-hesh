<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
  <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
</head>

<body>
<div x-data="{message: 'Click Me'}" class="px-10 flex justify-center items-center min-h-screen">
  <div class="grid grid-cols-4 gap-10 flex-1">
    <div class="h-32 bg-gray-300">
      <button @click="message = 'I have been clicked'" x-text="message"></button>
    </div>
    <div class="h-32 bg-gray-300"></div>
    <div class="h-32 bg-gray-300"></div>
    <div class="h-32 bg-gray-300"></div>
    <div class="h-32 bg-gray-300"></div>
    <div class="h-32 bg-gray-300"></div>
    <div class="h-32 bg-gray-300"></div>
    <div class="h-32 bg-gray-300"></div>
  </div>
</div>
<script>
  function pause(milliseconds = 1000) {
    return new Promise(resolve => setTimeout(resolve,milliseconds));
  }

  function flash(message) {
    window.dispatchEvent(new CustomEvent('flash',{
      detail: {message}
    }));
  }

  function game() {
    return {
      cards: [
        {color: 'green',flipped: false,cleared: false},
        {color: 'red',flipped: false,cleared: false},
        {color: 'blue',flipped: false,cleared: false},
        {color: 'yellow',flipped: false,cleared: false},
        {color: 'green',flipped: false,cleared: false},
        {color: 'red',flipped: false,cleared: false},
        {color: 'blue',flipped: false,cleared: false},
        {color: 'yellow',flipped: false,cleared: false},
      ].sort(() => Math.random() - .5),

      get flippedCards() {
        return this.cards.filter(card => card.flipped);
      },

      get clearedCards() {
        return this.cards.filter(card => card.cleared);
      },

      get remainingCards() {
        return this.cards.filter(card => !card.cleared);
      },

      get points() {
        return this.clearedCards.length;
      },

      async flipCard(card) {
        card.flipped = !card.flipped;

        if (this.flippedCards.length !== 2) return;

        if (this.hasMatch()) {
          flash('You found a match!');

          await pause();

          this.flippedCards.forEach(card => card.cleared = true);

          if (!this.remainingCards.length) {
            alert('You Won!');
          }
        } else {
          await pause();
        }

        this.flippedCards.forEach(card => card.flipped = false);
      },

      hasMatch() {
        return this.flippedCards[0]['color'] === this.flippedCards[1]['color'];
      }
    };
  }
</script>
</body>
</html>
